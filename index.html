<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Cricket Game Final</title>

<style>
*{ touch-action: manipulation; }
body{
  margin:0; background:#0b1c2d; color:white;
  font-family:Arial; text-align:center;
}
canvas{
  background:#2ecc71;
  border:4px solid white;
  border-radius:10px;
  width:95%; max-width:420px;
}
button{
  padding:14px; font-size:18px;
  margin:6px; width:90%; max-width:300px;
  border-radius:10px;
}
#banner{ font-size:24px; font-weight:bold; }
#timer{ font-size:22px; color:orange; }
#winner{ font-size:38px; color:yellow; margin-top:20px; }
#overlay{
  position:fixed; inset:0; background:#000c;
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
}
input{ padding:10px; font-size:16px; margin:6px; }
</style>
</head>

<body>

<div id="banner"></div>
<div id="timer"></div>
<h2 id="turn"></h2>
<div id="info"></div>

<canvas id="game" width="420" height="520"></canvas><br>

<button onclick="startBatting()">START BATTING</button>
<button onclick="hit()">HIT</button>
<button onclick="goFull()">FULL SCREEN</button>

<div id="winner"></div>

<div id="overlay">
  <h2>Cricket Match</h2>
  <input id="p1" placeholder="Player 1">
  <input id="p2" placeholder="Player 2">
  <button onclick="startMatch()">START MATCH</button>
</div>

<script>
const ctx = game.getContext("2d");

// ---------- Sounds ----------
const sHit=new Audio("hit.mp3");
const sDot=new Audio("dot.mp3");
const sOne=new Audio("one.mp3");
const sTwo=new Audio("two.mp3");
const sFour=new Audio("four.mp3");
const sSix=new Audio("six.mp3");
const sWicket=new Audio("wicket.mp3");
function play(s){ s.currentTime=0; s.play().catch(()=>{}); }
function vibrate(p){ navigator.vibrate && navigator.vibrate(p); }
function goFull(){ document.documentElement.requestFullscreen?.(); }

// ---------- State ----------
let players=[], cur=0;
let ballY=120, speed=6;
let bowling=false, hitDone=false;
let batAngle=0, batSwing=0;
let pause=false, pauseTime=0;
let target=null, gameOver=false;
let message="";
let superOver=false, superDone=false;

// ---------- Start ----------
function startMatch(){
  players=[
    {name:p1.value||"Player 1", runs:0, balls:12},
    {name:p2.value||"Player 2", runs:0, balls:12}
  ];
  overlay.style.display="none";
  updateUI();
}

// ---------- UI ----------
function updateUI(){
  if(gameOver) return;
  let p=players[cur];
  let totalBalls = superOver ? 6 : 12;
  let totalOvers = superOver ? 1 : 2;
  let bowled=totalBalls-p.balls;
  turn.textContent=p.name+" Batting";
  info.textContent=`Score ${p.runs} | Over ${Math.floor(bowled/6)}.${bowled%6}/${totalOvers}`;
  banner.textContent = superOver
    ? "SUPER OVER"
    : (cur===1 && target ? `TARGET: ${target}` : "");
}

// ---------- Draw ----------
function drawPitch(){ ctx.strokeStyle="white"; ctx.strokeRect(180,80,60,360); }
function drawWicket(){
  ctx.fillStyle="#f5deb3";
  for(let i=0;i<3;i++) ctx.fillRect(195+i*10,430,4,50);
}
function drawBat(){
  ctx.save(); ctx.translate(210,420); ctx.rotate(batAngle);
  ctx.fillStyle="#8b5a2b"; ctx.fillRect(-4,0,8,35);
  ctx.fillStyle="#deb887"; ctx.fillRect(-18,-90,36,90);
  ctx.restore();
}
function drawBall(){
  ctx.beginPath(); ctx.arc(210,ballY,12,0,Math.PI*2);
  ctx.fillStyle="red"; ctx.fill();
  ctx.strokeStyle="white"; ctx.stroke();
}
function drawMsg(){
  if(message){
    ctx.fillStyle="yellow"; ctx.font="bold 32px Arial";
    ctx.textAlign="center"; ctx.fillText(message,210,260);
  }
}

// ---------- Play ----------
function startBatting(){ if(!bowling&&!pause&&!gameOver) bowling=true; }
function resetBall(){ ballY=120; bowling=false; hitDone=false; }

function hit(){
  if(!bowling||hitDone||pause||gameOver) return;
  let p=players[cur];
  hitDone=true;
  p.balls--;
  batSwing=-0.8; setTimeout(()=>batSwing=0,150);
  play(sHit);

  if(ballY>260){ p.runs+=6; message="SIX!"; vibrate(200); play(sSix); }
  else if(ballY>230){ p.runs+=4; message="FOUR!"; play(sFour); }
  else if(ballY>210){ p.runs+=2; message="2 RUNS"; play(sTwo); }
  else if(ballY>200){ p.runs+=1; message="1 RUN"; play(sOne); }
  else if(ballY>180){ message="DOT BALL"; play(sDot); }
  else{ wicket(); return; }

  if(cur===1 && target!==null && p.runs>=target){
    message="TARGET CHASED";
    startBreak();
    return;
  }

  if(p.balls<=0){
    message="INNINGS OVER";
    startBreak();
    return;
  }

  resetBall();
  updateUI();
}

function wicket(){
  message="WICKET!";
  vibrate([200,100,200]);
  play(sWicket);
  startBreak();
}

// ---------- Break ----------
function startBreak(){
  pause=true;
  pauseTime=5;
  timer.textContent="BREAK: 5";
  let iv=setInterval(()=>{
    pauseTime--;
    timer.textContent="BREAK: "+pauseTime;
    if(pauseTime<=0){
      clearInterval(iv);
      timer.textContent="";
      nextPhase();
    }
  },1000);
}

// ---------- Phases ----------
function nextPhase(){
  pause=false;
  resetBall();

  if(cur===0){
    target = players[0].runs + 1;
    cur = 1;
    updateUI();
  }else{
    endMatch();
  }
}

// ---------- End / Super Over ----------
function endMatch(){
  let a=players[0], b=players[1];

  // DRAW â†’ SUPER OVER
  if(a.runs===b.runs && !superDone){
    superOver=true;
    superDone=true;
    message="MATCH DRAW! SUPER OVER!";
    players[0].runs=0; players[1].runs=0;
    players[0].balls=6; players[1].balls=6;
    cur=0; target=null;
    setTimeout(()=>{ message=""; updateUI(); },1000);
    return;
  }

  gameOver=true;
  winner.textContent =
    a.runs>b.runs
      ? `CONGRATULATIONS! ${a.name} WON`
      : `CONGRATULATIONS! ${b.name} WON`;
}

// ---------- Loop ----------
function loop(){
  ctx.clearRect(0,0,420,520);
  drawPitch(); drawWicket(); drawBat(); drawBall(); drawMsg();
  batAngle+=(batSwing-batAngle)*0.3;

  if(bowling&&!hitDone&&!pause){
    ballY+=speed;
    if(ballY>430){
      players[cur].balls--;
      wicket();
    }
  }
  requestAnimationFrame(loop);
}

game.addEventListener("touchstart",e=>{ e.preventDefault(); hit(); });
document.addEventListener("keydown",e=>{ if(e.code==="Space") hit(); });
loop();
</script>
</body>
</html>
